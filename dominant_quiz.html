<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚¯ã‚¤ã‚º Ver.2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #F5EEDC;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .quiz-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(24, 59, 78, 0.15);
            width: 600px;
            height: 700px;
            display: flex;
            flex-direction: column;
            border: 2px solid #27548A;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 28px;
            color: #183B4E;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .section-info {
            font-size: 14px;
            color: #27548A;
            margin-bottom: 5px;
        }

        .score {
            font-size: 16px;
            color: #183B4E;
            margin-bottom: 20px;
        }

        .question-container {
            margin-bottom: 20px;
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .question-number {
            font-size: 14px;
            color: #27548A;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 22px;
            color: #183B4E;
            font-weight: 600;
            line-height: 1.4;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .choices-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            height: 120px;
        }

        .choice-btn {
            padding: 12px 15px;
            border: 2px solid #27548A;
            border-radius: 12px;
            background: #F5EEDC;
            font-size: 15px;
            font-weight: 500;
            color: #183B4E;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .choice-btn:hover {
            background: #DDA853;
            color: white;
            transform: translateY(-2px);
        }

        .choice-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .choice-btn.correct {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .choice-btn.incorrect {
            background: #f44336;
            border-color: #f44336;
            color: white;
        }

        .button-area {
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .next-btn {
            display: none !important;
        }

        .result-area {
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .result-container {
            padding: 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            line-height: 1.4;
        }

        .result-container.show {
            visibility: visible;
        }

        .result-container.correct {
            background: #E8F5E8;
            border: 2px solid #4CAF50;
            color: #2E7D32;
        }

        .result-container.incorrect {
            background: #FFEBEE;
            border: 2px solid #f44336;
            color: #C62828;
        }

        .section-result {
            background: #E3F2FD;
            border: 2px solid #27548A;
            color: #183B4E;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            visibility: hidden;
        }

        .section-result.show {
            visibility: visible;
        }

        .section-result h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #183B4E;
        }

        .section-result p {
            font-size: 16px;
            line-height: 1.5;
        }

        .next-btn, .next-section-btn {
            padding: 12px 25px;
            background: #DDA853;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            margin: 0 auto;
        }

        .next-btn:hover, .next-section-btn:hover {
            background: #C49843;
            transform: translateY(-2px);
        }

        .restart-btn {
            padding: 10px 20px;
            background: #27548A;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            align-self: center;
        }

        .restart-btn:hover {
            background: #183B4E;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        @media (max-width: 770px) and (min-width: 460px) {
            .quiz-container {
                width: 95vw;
                height: 93vh;
                padding: 18px;
            }
            
            .choices-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                height: 105px;
            }
            
            .title {
                font-size: 22px;
            }
            
            .question-text {
                font-size: 17px;
                min-height: 48px;
            }
            
            .choice-btn {
                padding: 10px 8px;
                font-size: 13px;
                min-height: 48px;
            }

            .button-area {
                height: 55px;margin-top: 2rem;
            }

            .result-area {
                height: auto;
            }

            .question-container {
                height: 110px;
            }

            .header {
                margin-bottom: 18px;
            }

            .restart-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .next-section-btn {
                padding: 8px 16px;
                font-size: 13px;
            }

            .result-container {
                font-size: 13px;
                padding: 10px;
            }
        }

        @media (max-width: 768px) {
            .quiz-container {
                width: 95vw;
                height: 93vh;
                padding: 20px;
            }
            
            .choices-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                height: 110px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .question-text {
                font-size: 18px;
                min-height: 50px;
            }
            
            .choice-btn {
                padding: 12px 8px;
                font-size: 14px;
                min-height: 50px;
            }

            .button-area {
                height: 55px;margin-top: 2rem;
            }

            .result-area {
                height: auto;
            }

            .question-container {
                height: 120px;
            }

            .header {
                margin-bottom: 20px;
            }

            .restart-btn {
                padding: 7px 14px;
                font-size: 12px;
            }

            .next-section-btn {
                padding: 9px 18px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                width: 98vw;
                height: 93vh;
                padding: 15px;
            }
            
            .choices-container {
                height: 100px;
                gap: 8px;
            }
            
            .title {
                font-size: 20px;
            }
            
            .question-text {
                font-size: 16px;
                min-height: 45px;
            }
            
            .choice-btn {
                padding: 10px 6px;
                font-size: 13px;
                min-height: 45px;
            }

            .button-area {
                height: 50px;margin-top: 2rem;
            }

            .result-area {
                height: auto;
            }

            .question-container {
                height: 100px;
            }

            .header {
                margin-bottom: 15px;
            }

            .restart-btn {
                padding: 5px 10px;
                font-size: 11px;
            }

            .next-section-btn {
                padding: 7px 14px;
                font-size: 12px;
            }

            .result-container {
                font-size: 12px;
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                padding: 20px;
                height: 93vh;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .choice-btn {
                font-size: 13px;
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="header">
            <h1 class="title">ğŸ¼ ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚¯ã‚¤ã‚º</h1>
            <div class="section-info" style="display: none;">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ <span id="sectionNumber">1</span></div>
            <p class="score">æ­£è§£æ•°: <span id="correctCount">0</span> / <span id="totalCount">0</span></p>
        </div>

        <div class="question-container">
            <div class="question-number">å•é¡Œ <span id="questionNumber">1</span> / <span id="totalQuestions">30</span></div>
            <div class="question-text" id="questionText">å•é¡Œã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <div class="choices-container" id="choicesContainer">
            <!-- é¸æŠè‚¢ãŒJavaScriptã§ç”Ÿæˆã•ã‚Œã¾ã™ -->
        </div>

        <div class="button-area">
            <button class="restart-btn" onclick="restartQuiz()">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
            <button class="next-section-btn" id="nextSectionBtn" onclick="nextSection()">æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸</button>
        </div>

        <div class="result-area">
            <div class="result-container" id="resultContainer">
                <!-- çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>

            <div class="section-result" id="sectionResult">
                <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </div>

    <script>
        // bã‚’â™­ã«å¤‰æ›ã™ã‚‹é–¢æ•°
        function convertFlat(str) {
            return str.replace(/b/g, 'â™­');
        }

        // é‡è¤‡ã™ã‚‹ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒšã‚¢å®šç¾©
        const duplicateDominants = {
            'F#7': ['B', 'Bm'],
            'C#7': ['F#', 'F#m'],
            'G#7': ['C#', 'C#m'],
//           'D#7': ['G#m', 'Aâ™­m'], // G#mã¨Aâ™­mã¯ç•°ååŒéŸ³ã ãŒåˆ¥æ‰±ã„
//           'A#7': ['D#m', 'Eâ™­m'], // D#mã¨Eâ™­mã¯ç•°ååŒéŸ³ã ãŒåˆ¥æ‰±ã„
//           'E#7': ['A#m', 'Bâ™­m'], // A#mã¨Bâ™­mã¯ç•°ååŒéŸ³ã ãŒåˆ¥æ‰±ã„
            'B7': ['E', 'Em'],
            'E7': ['A', 'Am'],
            'A7': ['D', 'Dm'],
            'D7': ['G', 'Gm'],
            'G7': ['C', 'Cm'],
            'C7': ['F', 'Fm'],
            'F7': ['Bâ™­', 'Bâ™­m'],
            'Bâ™­7': ['Eâ™­', 'Eâ™­m'],
            'Eâ™­7': ['Aâ™­', 'Aâ™­m'],
            'Gâ™­7': ['Câ™­', 'Câ™­m'],  // ç†è«–ä¸Šã®ã‚­ãƒ¼
            'Dâ™­7': ['Gâ™­', 'Gâ™­m'],  // ç†è«–ä¸Šã®ã‚­ãƒ¼
            'Aâ™­7': ['Dâ™­', 'Dâ™­m']   // ç†è«–ä¸Šã®ã‚­ãƒ¼
        };

        // éŸ³æ¥½ç†è«–ãƒ‡ãƒ¼ã‚¿ï¼ˆç•°ååŒéŸ³ã‚’å«ã‚€å…¨ã‚­ãƒ¼ï¼‰
        const musicData = {
            major: {
                'C': 'G7', 'G': 'D7', 'D': 'A7', 'A': 'E7', 'E': 'B7',
                'B': 'F#7', 'F#': 'C#7', 'C#': 'G#7',
                'Câ™­': 'Gâ™­7', 'Gâ™­': 'Dâ™­7', 'Dâ™­': 'Aâ™­7',
                'F': 'C7', 'Bâ™­': 'F7', 'Eâ™­': 'Bâ™­7', 'Aâ™­': 'Eâ™­7'
            },
            minor: {
                'Am': 'E7', 'Em': 'B7', 'Bm': 'F#7', 'F#m': 'C#7', 'C#m': 'G#7',
                'G#m': 'D#7', 'D#m': 'A#7', 'A#m': 'E#7',
                'Bâ™­m': 'F7', 'Aâ™­m': 'Eâ™­7', 'Eâ™­m': 'Bâ™­7',
                'Dm': 'A7', 'Gm': 'D7', 'Cm': 'G7', 'Fm': 'C7'
            }
        };

        // å…¨ã¦ã®ã‚­ãƒ¼ã¨ã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™
        const allMajorKeys = Object.keys(musicData.major);
        const allMinorKeys = Object.keys(musicData.minor);
        const allKeys = [...allMajorKeys, ...allMinorKeys];
        const totalKeysPerSection = allKeys.length;

        // å…¨ã¦ã®ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™ï¼ˆé‡è¤‡é™¤å»ï¼‰
        const allDominants = [...new Set([...Object.values(musicData.major), ...Object.values(musicData.minor)])];

        let currentSection = 1;
        let questionCount = 0;
        let sectionQuestionCount = 0;
        let correctCount = 0;
        let sectionCorrectCount = 0;
        let isAnswered = false;
        let currentQuestion = {};
        let usedKeys = [];
        let availableKeys = [];

        // ã‚¯ã‚¤ã‚ºã®åˆæœŸåŒ–
        function initQuiz() {
            currentSection = 1;
            questionCount = 0;
            correctCount = 0;
            resetSection();
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆ
        function resetSection() {
            sectionQuestionCount = 0;
            sectionCorrectCount = 0;
            usedKeys = [];
            availableKeys = [...allKeys];
            updateDisplay();
            generateQuestion();
        }

        // å•é¡Œç”Ÿæˆ
        function generateQuestion() {
            if (availableKeys.length === 0) {
                showSectionResult();
                return;
            }

            questionCount++;
            sectionQuestionCount++;
            isAnswered = false;
            
            // ä½¿ç”¨å¯èƒ½ãªã‚­ãƒ¼ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
            const randomIndex = Math.floor(Math.random() * availableKeys.length);
            const selectedKey = availableKeys[randomIndex];
            
            // ä½¿ç”¨æ¸ˆã¿ã«ç§»å‹•
            usedKeys.push(selectedKey);
            availableKeys.splice(randomIndex, 1);

            // ã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
            const keyType = allMajorKeys.includes(selectedKey) ? 'major' : 'minor';
            const correctDominant = musicData[keyType][selectedKey];

            // å•é¡Œã‚¿ã‚¤ãƒ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
            const questionType = Math.random() < 0.5 ? 1 : 2;

            if (questionType === 1) {
                // ã‚¿ã‚¤ãƒ—1: ã‚­ãƒ¼ â†’ ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹
                const keyDisplay = selectedKey + (keyType === 'major' ? 'ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚­ãƒ¼' : 'ã‚­ãƒ¼');
                currentQuestion = {
                    type: 1,
                    question: `${keyDisplay}ã®ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ`,
                    correct: correctDominant,
                    choices: generateDominantChoices(correctDominant)
                };
            } else {
                // ã‚¿ã‚¤ãƒ—2: ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹ â†’ ã‚­ãƒ¼
                currentQuestion = {
                    type: 2,
                    question: `${correctDominant}ã®ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ`,
                    correct: selectedKey,
                    correctDominant: correctDominant, // é‡è¤‡ãƒã‚§ãƒƒã‚¯ç”¨
                    choices: [] // ä¸€æ—¦ç©ºã«ã—ã¦å¾Œã§ç”Ÿæˆ
                };
                // é¸æŠè‚¢ã‚’ç”Ÿæˆï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ã®ãŸã‚å•é¡Œè¨­å®šå¾Œã«å®Ÿè¡Œï¼‰
                currentQuestion.choices = generateKeyChoices(selectedKey, correctDominant);
            }

            displayQuestion();
        }

        // ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚³ãƒ¼ãƒ‰é¸æŠè‚¢ç”Ÿæˆï¼ˆé‡è¤‡ãªã—ï¼‰
        function generateDominantChoices(correct) {
            const choices = [correct];
            const otherOptions = allDominants.filter(option => option !== correct);
            
            while (choices.length < 6 && otherOptions.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherOptions.length);
                const randomOption = otherOptions[randomIndex];
                choices.push(randomOption);
                otherOptions.splice(randomIndex, 1);
            }
            
            return choices.sort(() => Math.random() - 0.5);
        }

        // ã‚­ãƒ¼é¸æŠè‚¢ç”Ÿæˆï¼ˆé‡è¤‡ãªã—ãƒ»é‡è¤‡ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚’è€ƒæ…®ï¼‰
        function generateKeyChoices(correct, dominantChord) {
            const choices = [correct];
            
            // é‡è¤‡ã™ã‚‹ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã®å ´åˆã€ã‚‚ã†ä¸€æ–¹ã®æ­£è§£ã‚’é™¤å¤–ãƒªã‚¹ãƒˆã«è¿½åŠ 
            let excludeKeys = [];
            if (dominantChord && duplicateDominants[dominantChord]) {
                const duplicateKeys = duplicateDominants[dominantChord];
                excludeKeys = duplicateKeys.filter(key => key !== correct);
            }
            
            const keyChoices = allKeys.filter(key => 
                key !== correct && !excludeKeys.includes(key)
            );
            
            while (choices.length < 6 && keyChoices.length > 0) {
                const randomIndex = Math.floor(Math.random() * keyChoices.length);
                const randomOption = keyChoices[randomIndex];
                choices.push(randomOption);
                keyChoices.splice(randomIndex, 1);
            }
            
            return choices.sort(() => Math.random() - 0.5);
        }

        // å•é¡Œè¡¨ç¤º
        function displayQuestion() {
            updateDisplay();
            document.getElementById('questionText').textContent = currentQuestion.question;
            
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            currentQuestion.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice;
                button.onclick = () => checkAnswer(choice, button);
                choicesContainer.appendChild(button);
            });

            hideResults();
        }

        // ç­”ãˆãƒã‚§ãƒƒã‚¯
        function checkAnswer(selectedAnswer, buttonElement) {
            if (isAnswered) return;
            
            isAnswered = true;
            const isCorrect = selectedAnswer === currentQuestion.correct;
            
            // å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === currentQuestion.correct) {
                    btn.classList.add('correct');
                } else if (btn === buttonElement && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });

            // è§£èª¬æ–‡ç”Ÿæˆ
            function generateExplanation(question, correct, isCorrect) {
                let explanation = '';
                
                if (question.type === 1) {
                    // ã‚­ãƒ¼ â†’ ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹
                    const keyName = question.question.split('ã®')[0];
                    explanation = `${keyName}ã®5åº¦ä¸Šã®éŸ³ï¼ˆãƒ‰ãƒŸãƒŠãƒ³ãƒˆï¼‰ã«ã‚»ãƒ–ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä½œã‚‹ã¨${correct}ã«ãªã‚Šã¾ã™ã€‚`;
                } else {
                    // ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹ â†’ ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰
                    const dominantChord = question.question.split('ã®')[0];
                    explanation = `${dominantChord}ã¯${correct}ã‚’ãƒˆãƒ‹ãƒƒã‚¯ã¨ã™ã‚‹ã‚­ãƒ¼ã®ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚`;
                }
                
                return explanation;
            }

            // çµæœè¡¨ç¤º
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.classList.add('show');
            
            const explanation = generateExplanation(currentQuestion, currentQuestion.correct, isCorrect);
            
            if (isCorrect) {
                correctCount++;
                sectionCorrectCount++;
                resultContainer.className = 'result-container correct show';
                resultContainer.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 8px;">âœ… æ­£è§£ï¼</div>
                    <div style="font-size: 13px; font-weight: 400;">${explanation}</div>
                `;
            } else {
                resultContainer.className = 'result-container incorrect show';
                resultContainer.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 5px;">âŒ ä¸æ­£è§£</div>
                    <div style="font-size: 14px; margin-bottom: 8px;">æ­£è§£ã¯ã€Œ${currentQuestion.correct}ã€ã§ã™</div>
                    <div style="font-size: 13px; font-weight: 400;">${explanation}</div>
                `;
            }

            updateDisplay();
            
            if (availableKeys.length === 0) {
                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†
                setTimeout(() => {
                    showSectionResult();
                }, 1500);
            } else {
                // è‡ªå‹•çš„ã«æ¬¡ã®å•é¡Œã¸é€²è¡Œ
                setTimeout(() => {
                    generateQuestion();
                }, 500);
            }
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµæœè¡¨ç¤º
        function showSectionResult() {
            hideResults();
            
            const percentage = Math.round((sectionCorrectCount / totalKeysPerSection) * 100);
            let comment = '';
            
            if (percentage >= 90) {
                comment = 'ç´ æ™´ã‚‰ã—ã„ï¼ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚»ãƒ–ãƒ³ã‚¹ã®ç†è§£ãŒå®Œç’§ã§ã™ã€‚';
            } else if (percentage >= 80) {
                comment = 'ã¨ã¦ã‚‚è‰¯ã„æˆç¸¾ã§ã™ï¼åŸºæœ¬çš„ãªç†è§£ãŒã§ãã¦ã„ã¾ã™ã€‚';
            } else if (percentage >= 70) {
                comment = 'è‰¯ã„æˆç¸¾ã§ã™ã€‚ã‚‚ã†å°‘ã—ç·´ç¿’ã™ã‚‹ã¨å®Œç’§ã«ãªã‚Šãã†ã§ã™ã€‚';
            } else if (percentage >= 60) {
                comment = 'åŸºæœ¬ã¯ç†è§£ã§ãã¦ã„ã¾ã™ã€‚å¾©ç¿’ã—ã¦ã•ã‚‰ã«å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚';
            } else {
                comment = 'åŸºç¤ã‹ã‚‰å¾©ç¿’ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            }

            const sectionResult = document.getElementById('sectionResult');
            sectionResult.innerHTML = `
                <h3>30å•å®Œäº†ï¼</h3>
                <p>æ­£è§£ç‡: ${percentage}% (${sectionCorrectCount}/${totalKeysPerSection})</p>
                <p>${comment}</p>
            `;
            sectionResult.classList.add('show');
            
            document.getElementById('nextSectionBtn').style.display = 'inline-block';
        }

        // æ¬¡ã®å•é¡Œ
        function nextQuestion() {
            generateQuestion();
        }

        // æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        function nextSection() {
            currentSection++;
            resetSection();
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            document.getElementById('sectionNumber').textContent = currentSection;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('totalCount').textContent = questionCount;
            document.getElementById('questionNumber').textContent = sectionQuestionCount;
            document.getElementById('totalQuestions').textContent = totalKeysPerSection;
        }

        // çµæœéè¡¨ç¤º
        function hideResults() {
            const sectionResult = document.getElementById('sectionResult');
            
            // é€šå¸¸ã®çµæœã‚¨ãƒªã‚¢ã¯éè¡¨ç¤ºã«ã—ãªã„ï¼ˆè§£èª¬ã‚’æ®‹ã™ãŸã‚ï¼‰
            sectionResult.classList.remove('show');
            document.getElementById('nextSectionBtn').style.display = 'none';
        }

        // ã‚¯ã‚¤ã‚ºãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
        function restartQuiz() {
            // çµæœã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.classList.remove('show', 'correct', 'incorrect');
            initQuiz();
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.onload = function() {
            initQuiz();
        };
    </script>
</body>
</html>